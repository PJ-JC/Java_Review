# 面试题

## 1. MVCC和乐观锁的区别

多版本并发控制（MVCC）是一种用来**解决读-写冲突**的无锁并发控制，也就是为事务分配单向增长的时间戳，为每个修改保存一个版本，版本与事务时间戳关联，读操作**只读该事务开始前的数据库的快照**。 这样在读操作不用阻塞写操作，写操作不用阻塞读操作的同时，避免了脏读和不可重复读

乐观并发控制（OCC）是一种用来**解决写-写冲突**的无锁并发控制，认为事务间争用没有那么多，所以先进行修改，在提交事务前，检查一下事务开始后，有没有新提交改变，如果没有就提交，如果有就放弃并重试。乐观并发控制类似自选锁。乐观并发控制适用于低数据争用，写冲突比较少的环境。

多版本并发控制可以结合基于锁的并发控制来解决写-写冲突，即MVCC+2PL，也可以结合乐观并发控制来解决写-写冲突。

https://www.zhihu.com/question/27876575

## 并发事务解决方案

**脏读、不可重复读和幻读**都是数据库读一致性问题，需要由数据库提供**一定的事务隔离机制**来解决。

（1）**锁机制**

解决**写-写**冲突问题。在读取数据前，对其加锁，防止其它事务对该数据进行修改。

- 悲观锁

  往往依靠数据库提供的锁机制。

- 乐观锁

  大多是基于数据版本**记录机制**来实现。

（2）**MVCC多版本并发控制**

解决**读-写**冲突问题。不用加锁，通过一定机制**生成一个数据请求时间点时的一致性数据快照**， 并用这个快照来提供一定级别 （语句级或事务级） 的一致性读取。这样在读操作的时候不需要阻塞写操作，写操作时不需要阻塞读操作。

## MVCC多版本并发控制




https://segmentfault.com/a/1190000012650596